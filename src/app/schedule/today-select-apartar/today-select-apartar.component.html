<div class="selector-container" [ngClass]="{ 'modo-reagendar-activo': modoReagendar }">

  <!-- ðŸ”³ Fondo oscuro al reagendar -->
  <div *ngIf="modoReagendar" class="overlay-reagendar"></div>

  <!-- ðŸ“Œ Encabezado y selecciÃ³n (ocultos al reagendar) -->
  <ng-container *ngIf="!modoReagendar">
    <div class="header" *ngIf="!servicioSeleccionado">
      <h3>Selecciona servicio</h3>
    </div>

    <app-servicio-selector
      [servicios]="evento?.servicios || []"
      [servicioSeleccionado]="servicioSeleccionado"
      (servicioChange)="seleccionarServicio($event)">
    </app-servicio-selector>

    <div class="header" *ngIf="servicioSeleccionado">
      <button (click)="anterior()" class="nav-btn">â€¹</button>
      <h3>Elegir nueva cita</h3>
      <button (click)="siguiente()" class="nav-btn">â€º</button>
    </div>
  </ng-container>

  <!-- âš ï¸ Sin servicio -->
  <div *ngIf="!servicioSeleccionado && !modoReagendar" class="no-servicio-global">
    <p>Primero selecciona un servicio para ver las citas disponibles.</p>
  </div>

  <!-- ðŸ—“ï¸ GRID de dÃ­as -->
  <div class="dias-grid" *ngIf="servicioSeleccionado">
    
    <!-- ðŸŸ¦ Modal de reagendar -->
    <div *ngIf="modoReagendar" class="cancelar-card">
      <div class="cancelar-contenido">
  <h3>Selecciona un nuevo horario</h3>
  <p>Puedes elegir otra hora disponible.</p>

  <div class="arrow-container">
    <svg class="arrow-down" viewBox="0 0 24 24" width="52" height="52">
      <path d="M12 4v14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <path d="M6 12l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>

    <button class="btn-cancelar" (click)="cancelarReagendar()">âœ– Cancelar</button>
  </div>
</div>

    </div>

    <!-- ðŸ“… DÃ­as -->
    <div class="dia" *ngFor="let d of diasVisibles">
      <div class="dia-card">
        <h4>{{ citaService.getEtiquetaDia(d) }}</h4>
        <p class="fecha">{{ d | date: 'yyyy-MM-dd' }}</p>

        <div class="horas">
          <button
            *ngFor="let h of horasDisponibles[d.toISOString().substring(0, 10)]; let i = index"
            [style.--i]="i"
            [disabled]="
              (modoReagendar && (h.ocupada || esMia(d, h.label))) ||
              (!modoReagendar && h.ocupada && !esMia(d, h.label))
            "
            [ngClass]="{
              ocupado: h.ocupada && !esMia(d, h.label),
              mia: esMia(d, h.label),
              parpadea: modoReagendar && !h.ocupada && !esMia(d, h.label)
            }"
            (click)="
              modoReagendar
                ? reagendar(d, h.label)
                : esMia(d, h.label)
                ? abrirModalCita(d, h.label)
                : reservar(d, h.label)
            "
          >
            {{ h.label }}
            <i *ngIf="esMia(d, h.label)" class="edit-icon fa fa-sync-alt"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- âœ… Modal de confirmaciÃ³n -->
<app-confirmar-cita-modal
  *ngIf="mostrarConfirmacion"
  [servicio]="servicioSeleccionado"
  [horaInicio]="horaSeleccionada"
  [horaFin]="horaFin"
  (confirm)="confirmarCita()"
  (cancel)="cancelarCita()">
</app-confirmar-cita-modal>



<app-reagendar-cita-modal
  [visible]="mostrarModalReagendar"
  [fecha]="fechaModal"
  [hora]="horaModal"
  (confirm)="onConfirmarReagendar()"
  (cancel)="onCancelarReagendar()"
  (delete)="onEliminarCita()"   
>
</app-reagendar-cita-modal>

